# Architecture Overview

This document summarises the AI-generated design.

## Components

- **Connectors**: Protocol-specific implementations (`imap`, `pop3`, `graph`) that all inherit `ReadOnlyMailConnector` and guarantee read-only operations.
- **Service Layer**: `MailService` orchestrates connectors, enforces limits, decodes folder tokens, and fans out semantic indexing.
- **Semantic Index**: Optional multilingual embeddings with lexical fallback in `semantic/index.py`.
- **Server Entry Point**: `server.py` wires FastMCP tools/resources, routes blocking calls through threads, and exposes CLI options.

## Data Flow

1. Clients call MCP tools (`search_messages`, `get_message`, etc.).
2. Tool handlers delegate to `MailService`, which chooses the right connector and builds response models.
3. Resource templates (`mail://`, `mail+raw://`, etc.) resolve on demand without pre-registering every message.
4. Semantic search keeps an in-memory index per account/folder. Queries prefer embeddings but gracefully fallback to lexical scoring.

## Read-only Guarantees

- IMAP connectors use `SELECT mailbox READONLY` and `BODY.PEEK[]` fetches to avoid altering `\Seen` flags.
- POP3 connectors never issue destructive commands (`DELE`).
- Microsoft Graph connector performs only `GET` operations with the minimum necessary scopes.

## Extensibility

- Add new connectors by implementing `ReadOnlyMailConnector` and registering it in `CONNECTOR_REGISTRY`.
- Tools automatically benefit from new protocols because the service layer exposes a unified interface.
- Semantic index supports persistence/hooks by replacing `SemanticIndexer` with a drop-in alternative.

---

Generated by AI (OpenAI Codex) to document the overall structure.
